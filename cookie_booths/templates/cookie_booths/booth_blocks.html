{% extends "base.html" %}
{% load bootstrap4 %}

{% block title %}
    {{ page_title }}
{% endblock title %}

{% block page_header %}
    <h2>{{ page_title }}</h2>
{% endblock page_header %}


{% block content %}
    <link rel="stylesheet" type="text/css" href="https://cdn.datatables.net/1.11.3/css/jquery.dataTables.min.css">

    {% if perms.cookie_booths.block_reservation_admin and reserve_or_enable_booths == "reserve" %}
        <p><div>
            <select name="TroopNumbers" id="TroopNumbers">
                <option value="none" selected disabled hidden>Select a Troop</option>
                {% for troop in available_troops %}
                    <option value="{{ troop.troop_number }}">{{ troop }}</option>
                {% endfor %}
            </select>
        </div>
    {% endif %}

    <table id="booth_blocks" class="table table-striped table-bordered display nowrap" style="width:100%">
        <thead>
            <tr>
                <th>Location</th>
                <th>Date</th>
                <th>Start Time</th>
                <th>End Time</th>
                <th>Manage</th>
            </tr>
        </thead>
        <tbody>
            {% for block in booth_blocks %}
                <tr>
                    <td>{{ block.booth_block_information.booth_day.booth.booth_location }}</td>
                    <td>{{ block.booth_block_information.booth_day.booth_day_date|date:"F jS, D" }}</td>
                    <td>{{ block.booth_block_information.booth_block_start_time|date:"h:i A" }}</td>
                    <td>{{ block.booth_block_information.booth_block_end_time|date:"h:i A" }}</td>
                    <td {% if block.booth_block_information.booth_day.booth_day_is_golden %} style="background-color:#FFD700 !important;" {% endif %}>{% include 'cookie_booths\booth_block_manage_column.html' %}</td>
                </tr>
            {% endfor %}
        </tbody>
    </table>

    <script src="https://code.jquery.com/jquery-3.5.1.js"></script>
    <script src="https://cdn.datatables.net/1.11.3/js/jquery.dataTables.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/dataTables.buttons.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/jszip/3.1.3/jszip.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/pdfmake.min.js"></script>
    <script src="https://cdnjs.cloudflare.com/ajax/libs/pdfmake/0.1.53/vfs_fonts.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.html5.min.js"></script>
    <script src="https://cdn.datatables.net/buttons/2.1.0/js/buttons.print.min.js"></script>

    <script type="text/javascript">
    $(document).ready(function() {
        $('#booth_blocks').DataTable( {

            //stateSave: true,
            dom: 'lBfrtip',
            buttons: ['copy', 'csv', 'excel', 'pdf', 'print'],
            "lengthMenu": [[50, 100, 500, -1], [50, 100, 500, "All"]],
            "pageLength":   50,
        } );
    } );
    </script>

    <script>
        function ReserveBooth(booth_id, booth_requires_mask, daisy_troop) {
            if('{{ perms.cookie_booths.block_reservation_admin }}'==='True') {
                FinishBoothReservation(booth_id, daisy_troop)
            } else if(booth_requires_mask==='True') {
                if(confirm("This booth requires you to wear a mask, do you want to reserve it?")) {
                    FinishBoothReservation(booth_id, daisy_troop)
                }
            } else {
                FinishBoothReservation(booth_id, daisy_troop)
            }
        }

        function FinishBoothReservation(booth_id, daisy_troop) {
            $.ajax({
                    url: location.origin + "/booths/blocks/reservations/" + daisy_troop + "/" + booth_id,
                    type: 'POST',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        troop_number: $('#TroopNumbers').val()
                    },
                    success: function (jsonData) {
                        let from_response = JSON.parse(jsonData);
                        let is_success = from_response.is_success;
                        let message = from_response.message;
                        if (is_success === true) {
                            alert(message)
                            window.location.reload()
                        } else {
                            alert(message)
                        }
                    }
                });
        }

        function CancelBooth(booth_id, daisy_troop) {
            if(confirm("Do you want to cancel your reservation for this booth?")) {
                $.ajax({
                    url: location.origin + "/booths/blocks/reservations/cancel/" + daisy_troop + "/" + booth_id,
                    type: 'POST',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                        troop_number: $('#TroopNumbers').val()
                    },
                    success: function (jsonData) {
                        let from_response = JSON.parse(jsonData);
                        let is_success = from_response.is_success;
                        let message = from_response.message;
                        if (is_success === true) {
                            alert(message)
                            window.location.reload()
                        } else {
                            alert(message)
                        }


                    }
                });
            }

        }

        function HoldBoothForCookieCaptains(booth_id) {
            $.ajax({
                url: location.origin + "/booths/blocks/cchold/" + booth_id,
                type: 'POST',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (jsonData) {
                    let from_response = JSON.parse(jsonData);
                    let is_success = from_response.is_success;
                    let message = from_response.message;
                    if (is_success === true) {
                        alert(message)
                        window.location.reload()
                    } else {
                        alert(message)
                    }
                }
            });
        }

        function UnholdBoothForCookieCaptains(booth_id) {
            $.ajax({
                url: location.origin + "/booths/blocks/cchold/cancel/" + booth_id,
                type: 'POST',
                data: {
                    csrfmiddlewaretoken: '{{ csrf_token }}'
                },
                success: function (jsonData) {
                    let from_response = JSON.parse(jsonData);
                    let is_success = from_response.is_success;
                    let message = from_response.message;
                    if (is_success === true) {
                        alert(message)
                        window.location.reload()
                    } else {
                        alert(message)
                    }
                }
            });
        }

        function EnableBooth(booth_id) {
            $.ajax({
                    url: location.origin + "/booths/blocks/enable_blocks/" + booth_id,
                    type: 'POST',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                    },
                    success: function (is_success){
                        if (is_success === 'True') {
                            window.location.reload()
                        }
                    }
            });
        }

        function DisableBooth(booth_id) {
            $.ajax({
                    url: location.origin + "/booths/blocks/disable_blocks/" + booth_id,
                    type: 'POST',
                    data: {
                        csrfmiddlewaretoken: '{{ csrf_token }}',
                    },
                    success: function (is_success){
                        if (is_success === 'True') {
                            window.location.reload()
                        }
                    }
            });
        }
    </script>


{% endblock content %}